version: "{branch}-ci-{build}"
os: Visual Studio 2013

on_finish:
- ps: $blockRdp = $true; iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))

environment:
  BOOST_ROOT: C:\Libraries\boost
  BOOST_INCLUDEDIR: C:\Libraries\boost\boost
  BOOST_LIBRARYDIR: C:\Libraries\boost\lib32-msvc-12.0
  QT_ROOT: C:\Qt\5.5\msvc2013
  GTEST_ROOT: C:\projects\googletest

install:
- cd C:\projects
- ps: Start-FileDownload https://github.com/google/googletest/archive/release-1.7.0.zip -FileName googletest-release-1.7.0.zip
- 7z x googletest-release-1.7.0.zip
- rename googletest-release-1.7.0 googletest
- cmake -E make_directory googletest\build
- cmake -E chdir googletest\build cmake ..
- cmake --build googletest\build
- cd C:\projects\cucumber-cpp

build_script:
- cmd: cmake -E make_directory build
# -DCUKE_ENABLE_EXAMPLES=on after importing Qt 5.5 pull request
- cmd: cmake -E chdir build cmake -DBOOST_ROOT="%BOOST_ROOT%" -DBOOST_INCLUDEDIR="%BOOST_INCLUDEDIR%" -DBOOST_LIBRARYDIR="%BOOST_LIBRARYDIR%" -DCMAKE_PREFIX_PATH="QT_ROOT" -DGTEST_ROOT=%GTEST_ROOT% -DGMOCK_ROOT=%GTEST_ROOT% ..
- cmd: cmake --build build

test_script:
- cmd: cmake --build build --target test
- cmd: cmake --build build --target features

